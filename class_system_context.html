<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BresserWeatherSensorLW: SystemContext Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BresserWeatherSensorLW
   </div>
   <div id="projectbrief">Bresser 868 MHz Weather Sensor Radio Receiver based on ESP32/RP2040 and SX1262/SX1276/LR1121 - sends data to a LoRaWAN Network</div>
   <div id="customdesc">
    <br>
    <a href="https://github.com/matthias-bs/BresserWeatherSensorLW">https://github.com/matthias-bs/BresserWeatherSensorLW</a>
    <br>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('class_system_context.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_system_context-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">SystemContext Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>System context for BresserWeatherSensorLW.  
 <a href="class_system_context.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_system_context_8h_source.html">SystemContext.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acafc50ac51197ddf4c29ccf145125422" id="r_acafc50ac51197ddf4c29ccf145125422"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#acafc50ac51197ddf4c29ccf145125422">begin</a> (void)</td></tr>
<tr class="memdesc:acafc50ac51197ddf4c29ccf145125422"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the system context.  <br /></td></tr>
<tr class="separator:acafc50ac51197ddf4c29ccf145125422"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a436858f6ad3d0a3aa54f2c89bbbee039" id="r_a436858f6ad3d0a3aa54f2c89bbbee039"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a436858f6ad3d0a3aa54f2c89bbbee039">isFirstBoot</a> (void)</td></tr>
<tr class="memdesc:a436858f6ad3d0a3aa54f2c89bbbee039"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if this is the first boot of the system after power-on/HW reset.  <br /></td></tr>
<tr class="separator:a436858f6ad3d0a3aa54f2c89bbbee039"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807e71c681c90c9a14ea41c413548e3f" id="r_a807e71c681c90c9a14ea41c413548e3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a807e71c681c90c9a14ea41c413548e3f">resetFailedJoinCount</a> (void)</td></tr>
<tr class="memdesc:a807e71c681c90c9a14ea41c413548e3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the failed join count.  <br /></td></tr>
<tr class="separator:a807e71c681c90c9a14ea41c413548e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8019791b3570a5b61c190eb9465d57ca" id="r_a8019791b3570a5b61c190eb9465d57ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a8019791b3570a5b61c190eb9465d57ca">sleepAfterFailedJoin</a> (void)</td></tr>
<tr class="memdesc:a8019791b3570a5b61c190eb9465d57ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sleep after a failed join attempt.  <br /></td></tr>
<tr class="separator:a8019791b3570a5b61c190eb9465d57ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa55e1b565d83f64935c35c0a5bbf2b4b" id="r_aa55e1b565d83f64935c35c0a5bbf2b4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#aa55e1b565d83f64935c35c0a5bbf2b4b">setTime</a> (time_t epoch, E_TIME_SOURCE source)</td></tr>
<tr class="memdesc:aa55e1b565d83f64935c35c0a5bbf2b4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set RTC to epoch.  <br /></td></tr>
<tr class="separator:aa55e1b565d83f64935c35c0a5bbf2b4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a314855a65abf689765e94b0a34dddcbd" id="r_a314855a65abf689765e94b0a34dddcbd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a314855a65abf689765e94b0a34dddcbd">printDateTime</a> (void)</td></tr>
<tr class="separator:a314855a65abf689765e94b0a34dddcbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20a4f83d1b78c63a42b43acc021fefe5" id="r_a20a4f83d1b78c63a42b43acc021fefe5"><td class="memItemLeft" align="right" valign="top"><a id="a20a4f83d1b78c63a42b43acc021fefe5" name="a20a4f83d1b78c63a42b43acc021fefe5"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>savePreferences</b> (void)</td></tr>
<tr class="memdesc:a20a4f83d1b78c63a42b43acc021fefe5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save preferences to flash memory. <br /></td></tr>
<tr class="separator:a20a4f83d1b78c63a42b43acc021fefe5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a034381c0ed1825e9214e6859dfccc271" id="r_a034381c0ed1825e9214e6859dfccc271"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a034381c0ed1825e9214e6859dfccc271">getVoltages</a> (void)</td></tr>
<tr class="memdesc:a034381c0ed1825e9214e6859dfccc271"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the voltages from ADC / Power Management Chip.  <br /></td></tr>
<tr class="separator:a034381c0ed1825e9214e6859dfccc271"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95a4c9948c8a76b9e75c3640d91b2a58" id="r_a95a4c9948c8a76b9e75c3640d91b2a58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a95a4c9948c8a76b9e75c3640d91b2a58">sleepIfSupplyLow</a> (void)</td></tr>
<tr class="memdesc:a95a4c9948c8a76b9e75c3640d91b2a58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sleep if battery voltage is low to prevent deep-discharging.  <br /></td></tr>
<tr class="separator:a95a4c9948c8a76b9e75c3640d91b2a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93ec32abb29e02c3666bc1c23159d5fb" id="r_a93ec32abb29e02c3666bc1c23159d5fb"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a93ec32abb29e02c3666bc1c23159d5fb">getBattlevel</a> (void)</td></tr>
<tr class="memdesc:a93ec32abb29e02c3666bc1c23159d5fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the battery fill level.  <br /></td></tr>
<tr class="separator:a93ec32abb29e02c3666bc1c23159d5fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a072cfedacf175d97d7b75e9604dac513" id="r_a072cfedacf175d97d7b75e9604dac513"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a072cfedacf175d97d7b75e9604dac513">getBattlevelDefault</a> (void)</td></tr>
<tr class="memdesc:a072cfedacf175d97d7b75e9604dac513"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the battery fill level (default implementation)  <br /></td></tr>
<tr class="separator:a072cfedacf175d97d7b75e9604dac513"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adab68d5365b6b041da52686434ce5510" id="r_adab68d5365b6b041da52686434ce5510"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#adab68d5365b6b041da52686434ce5510">sleepInterval</a> (void)</td></tr>
<tr class="memdesc:adab68d5365b6b041da52686434ce5510"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch between normal and long sleep interval.  <br /></td></tr>
<tr class="separator:adab68d5365b6b041da52686434ce5510"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9246014e5a279bb03b2ad3b9752ba9f4" id="r_a9246014e5a279bb03b2ad3b9752ba9f4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a9246014e5a279bb03b2ad3b9752ba9f4">longSleepActive</a> (void)</td></tr>
<tr class="memdesc:a9246014e5a279bb03b2ad3b9752ba9f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if long sleep is active.  <br /></td></tr>
<tr class="separator:a9246014e5a279bb03b2ad3b9752ba9f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a525c50b9ae13e4a7d7922ee291599d80" id="r_a525c50b9ae13e4a7d7922ee291599d80"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a525c50b9ae13e4a7d7922ee291599d80">isRtcSynched</a> (void)</td></tr>
<tr class="memdesc:a525c50b9ae13e4a7d7922ee291599d80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the RTC is synchronized to a time source.  <br /></td></tr>
<tr class="separator:a525c50b9ae13e4a7d7922ee291599d80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec72440587ad41d0c5d7ea646fde86c9" id="r_aec72440587ad41d0c5d7ea646fde86c9"><td class="memItemLeft" align="right" valign="top">E_TIME_SOURCE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#aec72440587ad41d0c5d7ea646fde86c9">getRtcTimeSource</a> (void)</td></tr>
<tr class="memdesc:aec72440587ad41d0c5d7ea646fde86c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the RTC time source.  <br /></td></tr>
<tr class="separator:aec72440587ad41d0c5d7ea646fde86c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd70559c86f099e43b92bc6fb302a8e1" id="r_abd70559c86f099e43b92bc6fb302a8e1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#abd70559c86f099e43b92bc6fb302a8e1">rtcNeedsSync</a> (void)</td></tr>
<tr class="memdesc:abd70559c86f099e43b92bc6fb302a8e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the RTC needs to be synchronized to a time source.  <br /></td></tr>
<tr class="separator:abd70559c86f099e43b92bc6fb302a8e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1da4f8297ff9978488c0fa8dd988dda4" id="r_a1da4f8297ff9978488c0fa8dd988dda4"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a1da4f8297ff9978488c0fa8dd988dda4">sleepDuration</a> (void)</td></tr>
<tr class="memdesc:a1da4f8297ff9978488c0fa8dd988dda4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute sleep duration in seconds.  <br /></td></tr>
<tr class="separator:a1da4f8297ff9978488c0fa8dd988dda4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c2a0840817331b095fb21b4de194249" id="r_a7c2a0840817331b095fb21b4de194249"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#a7c2a0840817331b095fb21b4de194249">uplinkDelay</a> (uint32_t timeUntilUplink, uint32_t uplinkInterval)</td></tr>
<tr class="memdesc:a7c2a0840817331b095fb21b4de194249"><td class="mdescLeft">&#160;</td><td class="mdescRight">LoRaWAN uplink delay.  <br /></td></tr>
<tr class="separator:a7c2a0840817331b095fb21b4de194249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab93448ce50f353f3dd4dce14da5b0d8a" id="r_ab93448ce50f353f3dd4dce14da5b0d8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_system_context.html#ab93448ce50f353f3dd4dce14da5b0d8a">gotoSleep</a> (uint32_t seconds)</td></tr>
<tr class="memdesc:ab93448ce50f353f3dd4dce14da5b0d8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enter sleep mode.  <br /></td></tr>
<tr class="separator:ab93448ce50f353f3dd4dce14da5b0d8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:adb4ee51f9813b60f7a4af17ed4667044" id="r_adb4ee51f9813b60f7a4af17ed4667044"><td class="memItemLeft" align="right" valign="top"><a id="adb4ee51f9813b60f7a4af17ed4667044" name="adb4ee51f9813b60f7a4af17ed4667044"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sleep_interval</b></td></tr>
<tr class="memdesc:adb4ee51f9813b60f7a4af17ed4667044"><td class="mdescLeft">&#160;</td><td class="mdescRight">preferences: sleep interval <br /></td></tr>
<tr class="separator:adb4ee51f9813b60f7a4af17ed4667044"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb900dff5d0ce5eee34f55dc02068a5" id="r_afeb900dff5d0ce5eee34f55dc02068a5"><td class="memItemLeft" align="right" valign="top"><a id="afeb900dff5d0ce5eee34f55dc02068a5" name="afeb900dff5d0ce5eee34f55dc02068a5"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sleep_interval_long</b></td></tr>
<tr class="memdesc:afeb900dff5d0ce5eee34f55dc02068a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">preferences: sleep interval long <br /></td></tr>
<tr class="separator:afeb900dff5d0ce5eee34f55dc02068a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42a337db6197e1453355f63c8810c409" id="r_a42a337db6197e1453355f63c8810c409"><td class="memItemLeft" align="right" valign="top"><a id="a42a337db6197e1453355f63c8810c409" name="a42a337db6197e1453355f63c8810c409"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>lw_stat_interval</b></td></tr>
<tr class="memdesc:a42a337db6197e1453355f63c8810c409"><td class="mdescLeft">&#160;</td><td class="mdescRight">preferences: LoRaWAN node status uplink interval <br /></td></tr>
<tr class="separator:a42a337db6197e1453355f63c8810c409"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>System context for BresserWeatherSensorLW. </p>
<p>Handles system initialization and management for the LoRaWAN node. This includes hardware-specific setup, RTC management, and power-saving features. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="acafc50ac51197ddf4c29ccf145125422" name="acafc50ac51197ddf4c29ccf145125422"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acafc50ac51197ddf4c29ccf145125422">&#9670;&#160;</a></span>begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::begin </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the system context. </p>
<p>Initialize the system context</p><ul>
<li>MCU / board specific initialization</li>
<li>Load node configuration from JSON file</li>
<li>Load preferences from flash memory</li>
<li>Initialize RTC and time zone </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_acafc50ac51197ddf4c29ccf145125422_cgraph.png" border="0" usemap="#aclass_system_context_acafc50ac51197ddf4c29ccf145125422_cgraph" alt=""/></div>
<map name="aclass_system_context_acafc50ac51197ddf4c29ccf145125422_cgraph" id="aclass_system_context_acafc50ac51197ddf4c29ccf145125422_cgraph">
<area shape="rect" title="Initialize the system context." alt="" coords="5,31,172,56"/>
<area shape="rect" href="class_system_context.html#a314855a65abf689765e94b0a34dddcbd" title=" " alt="" coords="220,5,444,31"/>
<area shape="poly" title=" " alt="" coords="172,32,206,28,207,34,172,37"/>
<area shape="rect" href="class_system_context.html#abd70559c86f099e43b92bc6fb302a8e1" title="Check if the RTC needs to be synchronized to a time source." alt="" coords="223,55,441,80"/>
<area shape="poly" title=" " alt="" coords="172,49,209,53,209,58,172,54"/>
</map>
</div>

</div>
</div>
<a id="a93ec32abb29e02c3666bc1c23159d5fb" name="a93ec32abb29e02c3666bc1c23159d5fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93ec32abb29e02c3666bc1c23159d5fb">&#9670;&#160;</a></span>getBattlevel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SystemContext::getBattlevel </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the battery fill level. </p>
<p>Wrapper for board specific implementations.</p>
<p>Get the battery fill level for LoRaWAN device status uplink. The LoRaWAN network server may periodically request this information.</p>
<p>0 = external power source 1 = lowest (empty battery) 254 = highest (full battery) 255 = unable to measure </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_a93ec32abb29e02c3666bc1c23159d5fb_cgraph.png" border="0" usemap="#aclass_system_context_a93ec32abb29e02c3666bc1c23159d5fb_cgraph" alt=""/></div>
<map name="aclass_system_context_a93ec32abb29e02c3666bc1c23159d5fb_cgraph" id="aclass_system_context_a93ec32abb29e02c3666bc1c23159d5fb_cgraph">
<area shape="rect" title="Get the battery fill level." alt="" coords="5,13,216,38"/>
<area shape="rect" href="class_system_context.html#a072cfedacf175d97d7b75e9604dac513" title="Get the battery fill level (default implementation)" alt="" coords="264,5,475,45"/>
<area shape="poly" title=" " alt="" coords="216,23,251,23,251,28,216,28"/>
</map>
</div>

</div>
</div>
<a id="a072cfedacf175d97d7b75e9604dac513" name="a072cfedacf175d97d7b75e9604dac513"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a072cfedacf175d97d7b75e9604dac513">&#9670;&#160;</a></span>getBattlevelDefault()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SystemContext::getBattlevelDefault </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the battery fill level (default implementation) </p>
<p>Get the battery fill level for LoRaWAN device status uplink. The LoRaWAN network server may periodically request this information.</p>
<p>0 = external power source 1 = lowest (empty battery) 254 = highest (full battery) 255 = unable to measure </p>

</div>
</div>
<a id="aec72440587ad41d0c5d7ea646fde86c9" name="aec72440587ad41d0c5d7ea646fde86c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec72440587ad41d0c5d7ea646fde86c9">&#9670;&#160;</a></span>getRtcTimeSource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">E_TIME_SOURCE SystemContext::getRtcTimeSource </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the RTC time source. </p>
<dl class="section return"><dt>Returns</dt><dd>E_TIME_SOURCE current RTC time source </dd></dl>

</div>
</div>
<a id="a034381c0ed1825e9214e6859dfccc271" name="a034381c0ed1825e9214e6859dfccc271"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a034381c0ed1825e9214e6859dfccc271">&#9670;&#160;</a></span>getVoltages()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::getVoltages </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the voltages from ADC / Power Management Chip. </p>
<p>Bus voltage: Supply voltage (e.g. USB or external power) if available, otherwise battery voltage. If no voltage converter is used, the permitted voltage range is limited by the 3.3V LDO input range and by the connected 3.3V loads. Typically 5V nominal.</p>
<p>The bus voltage is evaluated to determine the state of the power supply. </p>

</div>
</div>
<a id="ab93448ce50f353f3dd4dce14da5b0d8a" name="ab93448ce50f353f3dd4dce14da5b0d8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab93448ce50f353f3dd4dce14da5b0d8a">&#9670;&#160;</a></span>gotoSleep()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::gotoSleep </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>seconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Enter sleep mode. </p>
<p>On wake-up, the MCU will soft-reset and start from the beginning.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">seconds</td><td>Sleep duration in seconds </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a436858f6ad3d0a3aa54f2c89bbbee039" name="a436858f6ad3d0a3aa54f2c89bbbee039"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a436858f6ad3d0a3aa54f2c89bbbee039">&#9670;&#160;</a></span>isFirstBoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SystemContext::isFirstBoot </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if this is the first boot of the system after power-on/HW reset. </p>
<dl class="section return"><dt>Returns</dt><dd>true First boot after power-on/HW reset </dd>
<dd>
false Not the first boot </dd></dl>

</div>
</div>
<a id="a525c50b9ae13e4a7d7922ee291599d80" name="a525c50b9ae13e4a7d7922ee291599d80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a525c50b9ae13e4a7d7922ee291599d80">&#9670;&#160;</a></span>isRtcSynched()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SystemContext::isRtcSynched </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the RTC is synchronized to a time source. </p>
<dl class="section return"><dt>Returns</dt><dd>true if the RTC is synchronized to a time source </dd>
<dd>
false if the RTC is not synchronized </dd></dl>

</div>
</div>
<a id="a9246014e5a279bb03b2ad3b9752ba9f4" name="a9246014e5a279bb03b2ad3b9752ba9f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9246014e5a279bb03b2ad3b9752ba9f4">&#9670;&#160;</a></span>longSleepActive()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SystemContext::longSleepActive </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if long sleep is active. </p>
<p>Check if the sleep interval is set to the long sleep interval. This flag is sent in a LoRaWAN uplink message.</p>
<dl class="section return"><dt>Returns</dt><dd>true if long sleep is active </dd>
<dd>
false if long sleep is not active </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_a9246014e5a279bb03b2ad3b9752ba9f4_cgraph.png" border="0" usemap="#aclass_system_context_a9246014e5a279bb03b2ad3b9752ba9f4_cgraph" alt=""/></div>
<map name="aclass_system_context_a9246014e5a279bb03b2ad3b9752ba9f4_cgraph" id="aclass_system_context_a9246014e5a279bb03b2ad3b9752ba9f4_cgraph">
<area shape="rect" title="Check if long sleep is active." alt="" coords="5,5,200,45"/>
<area shape="rect" href="class_system_context.html#adab68d5365b6b041da52686434ce5510" title="Switch between normal and long sleep interval." alt="" coords="248,13,463,38"/>
<area shape="poly" title=" " alt="" coords="200,23,234,23,234,28,200,28"/>
</map>
</div>

</div>
</div>
<a id="a314855a65abf689765e94b0a34dddcbd" name="a314855a65abf689765e94b0a34dddcbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a314855a65abf689765e94b0a34dddcbd">&#9670;&#160;</a></span>printDateTime()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::printDateTime </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Print date and time (i.e. local time) </p>

</div>
</div>
<a id="a807e71c681c90c9a14ea41c413548e3f" name="a807e71c681c90c9a14ea41c413548e3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a807e71c681c90c9a14ea41c413548e3f">&#9670;&#160;</a></span>resetFailedJoinCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::resetFailedJoinCount </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the failed join count. </p>
<p>The failed join count is reset to 0 after a successful join. </p>

</div>
</div>
<a id="abd70559c86f099e43b92bc6fb302a8e1" name="abd70559c86f099e43b92bc6fb302a8e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd70559c86f099e43b92bc6fb302a8e1">&#9670;&#160;</a></span>rtcNeedsSync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SystemContext::rtcNeedsSync </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the RTC needs to be synchronized to a time source. </p>
<p>Checks if the RTC is synchronized to a time source</p>
<p>If the RTC is not synchronized or if the last clock sync is older than CLOCK_SYNC_INTERVAL, it returns true.</p>
<dl class="section return"><dt>Returns</dt><dd>true if the RTC needs to be synchronized </dd>
<dd>
false if the RTC is synchronized and the last clock sync is within CLOCK_SYNC_INTERVAL </dd></dl>

</div>
</div>
<a id="aa55e1b565d83f64935c35c0a5bbf2b4b" name="aa55e1b565d83f64935c35c0a5bbf2b4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa55e1b565d83f64935c35c0a5bbf2b4b">&#9670;&#160;</a></span>setTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::setTime </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>epoch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">E_TIME_SOURCE&#160;</td>
          <td class="paramname"><em>source</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set RTC to epoch. </p>
<p>Set RTC to epoch and store source and RTC sync timestamp</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">epoch</td><td>time in seconds since epoch </td></tr>
    <tr><td class="paramname">source</td><td>time source </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8019791b3570a5b61c190eb9465d57ca" name="a8019791b3570a5b61c190eb9465d57ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8019791b3570a5b61c190eb9465d57ca">&#9670;&#160;</a></span>sleepAfterFailedJoin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::sleepAfterFailedJoin </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sleep after a failed join attempt. </p>
<p>The sleep duration after a failed join is determined by the failed join count. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_a8019791b3570a5b61c190eb9465d57ca_cgraph.png" border="0" usemap="#aclass_system_context_a8019791b3570a5b61c190eb9465d57ca_cgraph" alt=""/></div>
<map name="aclass_system_context_a8019791b3570a5b61c190eb9465d57ca_cgraph" id="aclass_system_context_a8019791b3570a5b61c190eb9465d57ca_cgraph">
<area shape="rect" title="Sleep after a failed join attempt." alt="" coords="5,5,201,45"/>
<area shape="rect" href="class_system_context.html#ab93448ce50f353f3dd4dce14da5b0d8a" title="Enter sleep mode." alt="" coords="249,13,444,38"/>
<area shape="poly" title=" " alt="" coords="202,23,235,23,235,28,202,28"/>
</map>
</div>

</div>
</div>
<a id="a1da4f8297ff9978488c0fa8dd988dda4" name="a1da4f8297ff9978488c0fa8dd988dda4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1da4f8297ff9978488c0fa8dd988dda4">&#9670;&#160;</a></span>sleepDuration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t SystemContext::sleepDuration </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute sleep duration in seconds. </p>
<p>Minimum duration: SLEEP_INTERVAL_MIN If battery voltage is available and &lt;= BATTERY_WEAK: sleep_interval_long else sleep_interval</p>
<p>Additionally, the sleep interval is reduced from the default value to achieve a wake-up time aligned to an integer multiple of the interval after a full hour.</p>
<dl class="section return"><dt>Returns</dt><dd>sleep duration in seconds </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_a1da4f8297ff9978488c0fa8dd988dda4_cgraph.png" border="0" usemap="#aclass_system_context_a1da4f8297ff9978488c0fa8dd988dda4_cgraph" alt=""/></div>
<map name="aclass_system_context_a1da4f8297ff9978488c0fa8dd988dda4_cgraph" id="aclass_system_context_a1da4f8297ff9978488c0fa8dd988dda4_cgraph">
<area shape="rect" title="Compute sleep duration in seconds." alt="" coords="5,31,227,56"/>
<area shape="rect" href="class_system_context.html#a525c50b9ae13e4a7d7922ee291599d80" title="Check if the RTC is synchronized to a time source." alt="" coords="275,5,492,31"/>
<area shape="poly" title=" " alt="" coords="227,30,261,27,262,32,227,36"/>
<area shape="rect" href="class_system_context.html#adab68d5365b6b041da52686434ce5510" title="Switch between normal and long sleep interval." alt="" coords="276,55,491,80"/>
<area shape="poly" title=" " alt="" coords="227,51,263,54,262,59,227,56"/>
</map>
</div>

</div>
</div>
<a id="a95a4c9948c8a76b9e75c3640d91b2a58" name="a95a4c9948c8a76b9e75c3640d91b2a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95a4c9948c8a76b9e75c3640d91b2a58">&#9670;&#160;</a></span>sleepIfSupplyLow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::sleepIfSupplyLow </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sleep if battery voltage is low to prevent deep-discharging. </p>
<p>Checks if the bus voltage has reached the shut-off threshold and enters sleep mode for battery deep-discharge protection. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_system_context_a95a4c9948c8a76b9e75c3640d91b2a58_cgraph.png" border="0" usemap="#aclass_system_context_a95a4c9948c8a76b9e75c3640d91b2a58_cgraph" alt=""/></div>
<map name="aclass_system_context_a95a4c9948c8a76b9e75c3640d91b2a58_cgraph" id="aclass_system_context_a95a4c9948c8a76b9e75c3640d91b2a58_cgraph">
<area shape="rect" title="Sleep if battery voltage is low to prevent deep&#45;discharging." alt="" coords="5,31,249,56"/>
<area shape="rect" href="class_system_context.html#ab93448ce50f353f3dd4dce14da5b0d8a" title="Enter sleep mode." alt="" coords="311,5,505,31"/>
<area shape="poly" title=" " alt="" coords="249,30,297,25,297,31,250,35"/>
<area shape="rect" href="class_system_context.html#a1da4f8297ff9978488c0fa8dd988dda4" title="Compute sleep duration in seconds." alt="" coords="297,55,519,80"/>
<area shape="poly" title=" " alt="" coords="250,51,284,54,283,59,249,56"/>
<area shape="rect" href="class_system_context.html#a525c50b9ae13e4a7d7922ee291599d80" title="Check if the RTC is synchronized to a time source." alt="" coords="567,29,784,55"/>
<area shape="poly" title=" " alt="" coords="519,54,553,51,554,56,519,60"/>
<area shape="rect" href="class_system_context.html#adab68d5365b6b041da52686434ce5510" title="Switch between normal and long sleep interval." alt="" coords="568,79,783,104"/>
<area shape="poly" title=" " alt="" coords="519,75,555,78,554,83,519,80"/>
</map>
</div>

</div>
</div>
<a id="adab68d5365b6b041da52686434ce5510" name="adab68d5365b6b041da52686434ce5510"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adab68d5365b6b041da52686434ce5510">&#9670;&#160;</a></span>sleepInterval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t SystemContext::sleepInterval </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Switch between normal and long sleep interval. </p>
<p>Switch between normal and long sleep interval depending on the system voltage (default) or battery state of charge (PowerFeather). The long sleep interval is used to save energy (eco mode). A hysteresis is implemented by using two voltage/SOC thresholds - &lt;voltage|soc&gt;_eco_exit and &lt;voltage|soc&gt;_eco_enter .</p>
<p>The normal sleep interval is used as default, e.g. if the system voltage/battery SOC is not available. </p>

</div>
</div>
<a id="a7c2a0840817331b095fb21b4de194249" name="a7c2a0840817331b095fb21b4de194249"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c2a0840817331b095fb21b4de194249">&#9670;&#160;</a></span>uplinkDelay()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SystemContext::uplinkDelay </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeUntilUplink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>uplinkInterval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>LoRaWAN uplink delay. </p>
<p>Uses MCU sleep mode if possible, otherwise delays for the given time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeUntilUplink</td><td>time until next uplink in milliseconds </td></tr>
    <tr><td class="paramname">uplinkInterval</td><td>planned uplink interval in seconds </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="_system_context_8h_source.html">SystemContext.h</a></li>
<li>src/<a class="el" href="_system_context_8cpp.html">SystemContext.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_system_context.html">SystemContext</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
